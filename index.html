<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <meta charset="utf-8">
  </head>
  <body>
    <style>
      body {
            padding: 0;
            margin: 0;
        }
      html, body, #map {
          height: 100%;
          width: 100%;
      }
    </style>
    <div id="map"></div>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js" charset="utf-8"></script>
    <script>
      var map = L.map('map').setView([25.0275, 121.5251], 11);
      L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 22,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);

      var buildingStyle = {
        weight: 1,
        fill:true,
        fillColor:"black",
        fillOpacity:0.6
      };

      var taskStyle = {
        weight: 1,
        fill: true,
        fillColor:"blue",
        fillOpacity:0.3
      }

      d3.json('tasks.geojson',function(d) { 
        L.geoJson(d,{
          style:taskStyle,
          onEachFeature: function(feature,layer) {
            layer.bindPopup(feature.properties.filename);
            layer.on("click", function(e) {
              d3.json('http://tpe-buildings.s3-ap-northeast-1.amazonaws.com/geojsons/' + feature.properties.filename + '.geojson.gz', function(d) {
                  L.geoJson(d,{style:buildingStyle}).addTo(map);
              });
            });
          }}).addTo(map);
      });
    </script>
  </body>
</html>

